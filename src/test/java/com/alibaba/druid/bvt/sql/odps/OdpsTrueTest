/*
 * Copyright 2015 Alibaba.com All right reserved. This software is the
 * confidential and proprietary information of Alibaba.com ("Confidential
 * Information"). You shall not disclose such Confidential Information and shall
 * use it only in accordance with the terms of the license agreement you entered
 * into with Alibaba.com.
 */
package com.alibaba.druid.bvt.sql.odps;

import java.util.List;

import junit.framework.TestCase;

import org.junit.Assert;

import com.alibaba.druid.sql.SQLUtils;
import com.alibaba.druid.sql.ast.SQLStatement;
import com.alibaba.druid.sql.dialect.odps.parser.OdpsStatementParser;
import com.alibaba.druid.sql.dialect.odps.visitor.OdpsSchemaStatVisitor;
import com.alibaba.druid.sql.visitor.SchemaStatVisitor;

/**
 * 
 * 
 * @author chenyoulin 2015年5月28日 上午11:26:00
 */
public class OdpsTrueTest extends TestCase {

    public void test_0() {
        String sql = "select COUNT(1) as a from ctu_trade_paid_done where isTongren = true or false = abc";
        OdpsStatementParser parser = new OdpsStatementParser(sql);
        List<SQLStatement> statementList = parser.parseStatementList();
        SQLStatement stmt = statementList.get(0);

        Assert.assertEquals(1, statementList.size());

        SchemaStatVisitor visitor = new OdpsSchemaStatVisitor();
        stmt.accept(visitor);
        System.out.println(sql);
        System.out.println("Tables : " + visitor.getTables());
        System.out.println("fields : " + visitor.getColumns());
        System.out.println("Conditions : " + visitor.getConditions());
        Assert.assertTrue((Boolean) (visitor.getConditions().get(0).getValues().get(0)));
        Assert.assertFalse((Boolean) (visitor.getConditions().get(1).getValues().get(0)));

        System.out.println();
        System.out.println("---------------------------");
        System.out.println(SQLUtils.toOdpsString(stmt));
    }
}
